<!DOCTYPE html>
<!-- saved from url=(0014)about:internet -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AccuTrack Inc.</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
    <!-- BOOTSTRAP STYLES-->
    <link href="assets/css/bootstrap.css" rel="stylesheet" />
    <!-- FONTAWESOME STYLES-->
    <link href="assets/css/font-awesome.css" rel="stylesheet" />
    <!-- CUSTOM STYLES-->
    <link href="assets/css/custom.css" rel="stylesheet" />
    <!-- GOOGLE FONTS-->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css' />
</head>
<body>
    <div id="wrapper">
        <div class="navbar navbar-inverse navbar-fixed-top">
            <div class="adjust-nav">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".sidebar-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a href="#"><img src="assets/img/AccuTrack.png" class="img-responsive" /></a>
                </div>
                <div class="navbar-collapse collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li><a href="#">See Website</a></li>
                        <li><a href="#">Open Ticket</a></li>
                        <li><a href="#">Report Bug</a></li>
                    </ul>
                </div>

            </div>
        </div>
        <!-- /. NAV TOP  -->
        <nav class="navbar-default navbar-side" role="navigation">
            <div class="sidebar-collapse">
                <ul class="nav" id="main-menu">
                    <li class="text-center user-image-back">
                        <img src="assets/img/Walmatt.png" class="img-responsive" />
                    </li>
					<li id = "groupname">
					</li>
                </ul>
            </div>

        </nav>
        <!-- /. NAV SIDE  -->
        <div id="page-wrapper">
            <div id="page-inner">
                <div class="row">
                    <div class="col-md-12">
                        <h2>Welcome to our Portal</h2>
                    </div>
					<div class="col-md-4" style = "width:100%">
                        <div class="form-group" style = "display:inline-block; padding:10px;">
                            <label>Name</label>
                            <output/>
                            <p id = "OutName">NA</p>
                        </div>
						<div class="form-group" style = "display:inline-block;padding:10px;">
                            <label>Age</label>
                            <output/>
                            <p id = "OutAge">NA</p>
                        </div>
						<div class="form-group" style = "display:inline-block;padding:10px;">
                            <label>Gender</label>
                            <output/>
                            <p id = "OutGender">NA</p>
                        </div>
						<div class="form-group" style = "display:inline-block;padding:10px;">
                            <label>Height</label>
                            <output/>
                            <p id = "OutHeight">NA</p>
                        </div>
						<div class="form-group" style = "display:inline-block;padding:10px;">
                            <label>Team</label>
                            <output/>
                            <p id = "OutTeam">NA</p>
                        </div>
						<div class="form-group" style = "display:inline-block;padding:10px;">
                            <label>Weight</label>
                            <output/>
                            <p id = "OutWeight">NA</p>
                        </div>
                    </div>
                </div>
				<div>Enter the Date and type of limb you wish to view the data for
					<input type="date" id="dateInput" placeholder="mm/dd/yyyy"></input>
					<br>
					<select id = "limbtype">
					  <option value="rl">Right Leg</option>
					  <option value="ra">Right Arm</option>
					  <option value="ll">Left Leg</option>
					  <option value="la">Left Arm</option>
					</select>
				</div>
				
				<canvas id="myChart" width="100%"></canvas>				
                    <div class="col-md-6">
                        <h5>User Collected Data</h5>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>First Name</th>
                                        <th>Last Name</th>
                                        <th>Username</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="success">
                                        <td>1</td>
                                        <td>Mark</td>
                                        <td>Otto</td>
                                        <td>@mdo</td>
                                    </tr>                                    
                                </tbody>
                            </table>
							<footer>&copy; Developed by AccuTrack Team 2018</footer>
                        </div>
                    </div>        
                    </div>
                </div>            
                </div>
            </div>
            <!-- /. PAGE INNER  -->
        </div>
        <!-- /. PAGE WRAPPER  -->
    </div>
    <!-- /. WRAPPER  -->
    <!-- SCRIPTS -AT THE BOTOM TO REDUCE THE LOAD TIME-->
    <!-- JQUERY SCRIPTS -->
    <script src="assets/js/jquery-1.10.2.js"></script>
    <!-- BOOTSTRAP SCRIPTS -->
    <script src="assets/js/bootstrap.min.js"></script>
    <!-- METISMENU SCRIPTS -->
    <script src="assets/js/jquery.metisMenu.js"></script>
    <!-- CUSTOM SCRIPTS -->
    <script src="assets/js/custom.js"></script>

<script src="https://www.gstatic.com/firebasejs/5.1.0/firebase.js"></script>
<script>
  var plotdata = Array(240);
  var label = "";
  var xaxis= [];
  var myChart;
  var dateinput;
  var hasheddate = 0;
  var digit = 0;
  document.getElementById("dateInput").valueAsDate = new Date();
  for(var i=0;i<1440;i+=6){
  xaxis.push(formatTime(i));
  }
  var fireBasedata = [];
  var teamlist = [];
  function plotgraph(){
  plotdata = Array(240);
  dateinput = document.getElementById("dateInput").value;
	dateinput = dateinput.split("-");
	if(dateinput != undefined){
	hasheddate = dateinput[0]*372 + dateinput[1]*31 + dateinput[2]*1;
	}
    //console.log(hasheddate); 
	var limbtype = document.getElementById("limbtype").value;
	// RIGHT LEG
	if(limbtype === "rl"){
	label = "Right Leg";
	if(fireBasedata[digit].History.RightLeg!=undefined){
	for (key1 in fireBasedata[digit].History.RightLeg[hasheddate]){
	for (key in fireBasedata[digit].History.RightLeg[hasheddate][key1]) {
	if(key!=undefined){
    if (fireBasedata[digit].History.RightLeg[hasheddate][key1].hasOwnProperty(key)) {
		plotdata[key1/6] = fireBasedata[digit].History.RightLeg[hasheddate][key1][key];
    }
	}
	}
	}
	}	
	myChart.destroy();
	}
	// RIGHT ARM
	if(limbtype === "ra"){
	label = "Right Arm";
	if(fireBasedata[digit].History.RightHand!=undefined){
	for (key1 in fireBasedata[digit].History.RightHand[hasheddate]){
	for (key in fireBasedata[digit].History.RightHand[hasheddate][key1]) {
	if(key!=undefined){
    if (fireBasedata[digit].History.RightHand[hasheddate][key1].hasOwnProperty(key)) {
		plotdata[key1/6] = fireBasedata[digit].History.RightHand[hasheddate][key1][key];
    }
	}
	}
	}
	}	
	myChart.destroy();
	}
	//LEFT LEG
	if(limbtype === "ll"){
	label = "Left Leg";
	if(fireBasedata[digit].History.LeftLeg!=undefined){
	for (key1 in fireBasedata[digit].History.LeftLeg[hasheddate]){
	for (key in fireBasedata[digit].History.LeftLeg[hasheddate][key1]) {
	if(key!=undefined){
    if (fireBasedata[digit].History.LeftLeg[hasheddate][key1].hasOwnProperty(key)) {
		plotdata[key1/6] = fireBasedata[digit].History.LeftLeg[hasheddate][key1][key];
    }
	}
	}
	}
	}	
	myChart.destroy();
	}
	//LEFT ARM
	if(limbtype === "la"){
	label = "Left Arm";
	if(fireBasedata[digit].History.LeftHand!=undefined){
	for (key1 in fireBasedata[digit].History.LeftHand[hasheddate]){
	for (key in fireBasedata[digit].History.LeftHand[hasheddate][key1]) {
	if(key!=undefined){
    if (fireBasedata[digit].History.LeftHand[hasheddate][key1].hasOwnProperty(key)) {
		plotdata[key1/6] = fireBasedata[digit].History.LeftHand[hasheddate][key1][key];
    }
	}
	}
	}
	}	
	myChart.destroy();
	}
	initchart();
	}
  document.getElementById("dateInput").addEventListener("change", function() {
	plotgraph();  
});
document.getElementById("limbtype").addEventListener("change", function() {
	plotgraph();  
});
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyCtJG_Ccxiaai-SflibYt8ilmSV6TnuErg",
    authDomain: "accutrack-iot.firebaseapp.com",
    databaseURL: "https://accutrack-iot.firebaseio.com",
    projectId: "accutrack-iot",
    storageBucket: "accutrack-iot.appspot.com",
    messagingSenderId: "790708014828"
  };
  firebase.initializeApp(config);
  function getData(callbackIN) {
    var ref = firebase.database().ref("Users");
        ref.once('value').then(function (snapshot) {
        callbackIN(snapshot.val());
    });
	
     var currentValueUpdate = firebase.database().ref("Users");
     currentValueUpdate.on('value', function(snapshot) {
		console.log(snapshot.val());
		firebasedata = [];
		var data = snapshot.val();
		    for(var i=0; i<data.length; i++) {
        fireBasedata.push({
        Age: data[i]['Age'],
        Gender: data[i]['Gender'],
		CurrentValue: data[i]['CurrentValue'],
		Height:data[i]['Height'],
		History:data[i]['History'],
		Name:data[i]['Name'],
		Weight:data[i]['Weight'],
		Team: data[i]['Team']
    });
	}
	});
}
window.addEventListener("load", getData(genFunction));
var groupdiv = document.getElementById("groupname");
var outname = document.getElementById("OutName");
var outage = document.getElementById("OutAge");
var outgender = document.getElementById("OutGender");
var outheight = document.getElementById("OutHeight");
var outteam = document.getElementById("OutTeam");
var outweight = document.getElementById("OutWeight");
initchart();
function genFunction(data) {
    for(var i=0; i<data.length; i++) {
        fireBasedata.push({
        Age: data[i]['Age'],
        Gender: data[i]['Gender'],
		CurrentValue: data[i]['CurrentValue'],
		Height:data[i]['Height'],
		History:data[i]['History'],
		Name:data[i]['Name'],
		Weight:data[i]['Weight'],
		Team: data[i]['Team']
    });
	teamlist[i] = data[i]['Team'];
}
for(var i = 0; i<teamlist.length; i++){
	var a = document.createElement("a");
	var b = document.createElement("ul");
	b.id = "ul" + teamlist[i];
	b.className = "nav nav-second-level collapse"; // start as collapsed
	a.id = "a" + teamlist[i];
	b.innerHTML += "<li><a>" + fireBasedata[i].Name + "</a></li>";
    a.innerHTML += "<i class =\"fa fa-sitemap\"></i>" + teamlist[i] + "<span id = \"arrow\" class=\"fa arrow\"></span>";
	b.onclick = function(event){
	if( event.srcElement.innerText != "Daniel"){
	digit = 1;
	}
	else{
	digit = 0;
	}
	outname.innerHTML = fireBasedata[digit].Name;
	outage.innerHTML = fireBasedata[digit].Age;
	outgender.innerHTML = fireBasedata[digit].Gender;
	outheight.innerHTML = fireBasedata[digit].Height;
	outteam.innerHTML = fireBasedata[digit].Team;
	outweight.innerHTML = fireBasedata[digit].Weight;
	plotgraph(document.getElementById("dateInput").value);
	}
	a.onclick= function(event) {
	if( event.srcElement.innerText == "Truck Loaders"){
	var b = document.getElementById("ul" + "Truck Loaders");
	var a = document.getElementById("a" + "Truck Loaders");
	if(b.classList.contains('collapse')){
		b.className = "nav nav-second-level"; // start as collapsed	
		a.className = "active";
	}
	else{
		b.className = "nav nav-second-level collapse"; // start as collapsed	
		a.className = "";
	}
	}
	else{
	var b = document.getElementById("ul" + "Janitor");
	var a = document.getElementById("a" + "Janitor");
	if(b.classList.contains('collapse')){
		b.className = "nav nav-second-level"; // start as collapsed	
		a.className = "active";
	}
	else{
		b.className = "nav nav-second-level collapse"; // start as collapsed	
		a.className = "";
	}
	}
	}
	groupdiv.appendChild(a);
	groupdiv.appendChild(b);	
	//console.log(groupdiv.innerHTML);
}
}

//BAR Chart
function initchart(){
var ctx = document.getElementById("myChart");
myChart = new Chart(ctx, {
type: 'bar',
data: {
    labels: xaxis,
    datasets: [{
        label: label,
		backgroundColor: "rgb(100,100,100)",
        borderColor: "rgba(75,192,192,1)",
        data: plotdata,
    }]
},
options: {
	showLines: true,
    scales: {
        yAxes: [{
            ticks: {
                beginAtZero:true,
            }
        }],
		xAxes: [{
		barPercentage: 0.9,
		categorySpacing: 0,
		ticks: {
        maxTicksLimit: 24,
		barPercentage: 0.9,
            },
        }],
    }
}
});
}
function formatTime(minutes) {
	var hours = Math.floor( minutes / 60);          
    var minutes = minutes % 60;
    return [
        hours,minutes
    ]
        .join(":")
        .replace(/\b(\d)\b/g, "0$1")
}
</script>
</body>
</html>
